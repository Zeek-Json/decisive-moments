name: siliconflow Connection Test

# è§¦å‘æœºåˆ¶ï¼šæ‰‹åŠ¨è§¦å‘ (ç‚¹å‡»æŒ‰é’®)
on:
  workflow_dispatch:

jobs:
  test-ignition:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: pip install openai

      - name: Test siliconflow API
        env:
          # è¿™é‡Œå¼•ç”¨æ‚¨åˆšæ‰è®¾ç½®çš„ Secret
          siliconflow_API_KEY: ${{sk-pkmnwpjvwrfzutvtoifkffycccpsitcflpdbxixigzqkpkfc}}
        run: |
          python -c "
          import os
          from openai import OpenAI

          # é…ç½® siliconflow å®¢æˆ·ç«¯
          client = OpenAI(
              api_key=os.environ.get('siliconflow_API_KEY'),
              base_url='https://api.siliconflow.cn'  # å…³é”®ï¼šæŒ‡å‘ siliconflow
          )

          print('ğŸ“¡ æ­£åœ¨å‘¼å« siliconflow...')
          
          try:
              response = client.chat.completions.create(
                  model='siliconflow-chat',
                  messages=[
                      {'role': 'system', 'content': 'You are a philosophical AI.'},
                      {'role': 'user', 'content': 'ç”¨ç®€çŸ­çš„ä¸­æ–‡è§£é‡Šï¼šä»€ä¹ˆæ˜¯é€’å½’ï¼Ÿ'},
                  ],
                  stream=False
              )
              print('âœ… è¿æ¥æˆåŠŸï¼æ”¶åˆ°å›å¤ï¼š')
              print(response.choices[0].message.content)
          except Exception as e:
              print(f'âŒ è¿æ¥å¤±è´¥: {e}')
              exit(1)
          "

