name: SiliconFlow Connection Test

on:
  workflow_dispatch:

jobs:
  test-siliconflow:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: pip install openai

      - name: Test SiliconFlow API
        env:
          # ä»ä¿é™©åº“è¯»å–æ–° Key
          SILICONFLOW_API_KEY: ${{ sk-pkmnwpjvwrfzutvtoifkffycccpsitcflpdbxixigzqkpkfc }}
        run: |
          python -c "
          import os
          from openai import OpenAI

          # é…ç½® SiliconFlow å®¢æˆ·ç«¯
          # æ³¨æ„ï¼šSiliconFlow çš„æ ‡å‡†å…¥å£é€šå¸¸éœ€è¦åŠ  /v1
          client = OpenAI(
              api_key=os.environ.get('SILICONFLOW_API_KEY'),
              base_url='https://api.siliconflow.cn/' 
          )

          print('ğŸš€ æ­£åœ¨å‘¼å« SiliconFlow èŠ‚ç‚¹...')
          
          try:
              # SiliconFlow éœ€è¦å‡†ç¡®çš„æ¨¡å‹åç§°ï¼ŒDeepSeek V3 çš„å…¨åé€šå¸¸æ˜¯è¿™ä¸ªï¼š
              response = client.chat.completions.create(
                  model='deepseek-ai/DeepSeek-V3.2', 
                  messages=[
                      {'role': 'system', 'content': 'You are a logic engine.'},
                      {'role': 'user', 'content': 'è¯·ç®€è¿°ï¼šä»€ä¹ˆæ˜¯â€œç¬¬ä¸€æ€§åŸç†â€ï¼Ÿ'},
                  ],
                  stream=False
              )
              print('âœ… è¿æ¥æˆåŠŸï¼æ”¶åˆ° SiliconFlow å›å¤ï¼š')
              print('-' * 30)
              print(response.choices[0].message.content)
              print('-' * 30)
          except Exception as e:
              print(f'âŒ è¿æ¥å¤±è´¥: {e}')
              # å¦‚æœæ˜¯æ¨¡å‹åç§°é”™è¯¯ï¼Œæ‰“å°æç¤º
              if 'model' in str(e):
                  print('æç¤ºï¼šè¯·æ£€æŸ¥ SiliconFlow å®˜ç½‘ç¡®è®¤æœ€æ–°çš„æ¨¡å‹åç§° (Model ID)ã€‚')
              exit(1)
          "
